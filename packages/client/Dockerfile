FROM oven/bun:alpine

WORKDIR /app

COPY package.json bun.lockb vite.config.ts .

RUN bun install

COPY . .

ARG VITE_APP_TITLE
ARG VITE_APP_API_HOST
ARG VITE_APP_WEBSOCKET_HOST
ARG VITE_APP_STORY_POINTING_OPTIONS
ARG VITE_APP_STRIPE_PK
ARG VITE_APP_STRIPE_PRODUCT_ID

ENV VITE_APP_TITLE=${VITE_APP_TITLE:-'Team Tools'}
ENV VITE_APP_API_HOST=${VITE_APP_API_HOST:-http://localhost:3000}
ENV VITE_APP_WEBSOCKET_HOST=${VITE_APP_WEBSOCKET_HOST:-ws://localhost:3000}
ENV VITE_APP_STORY_POINTING_OPTIONS=${VITE_APP_STORY_POINTING_OPTIONS:-0,0.5,1,2,3,5,8,13,?}
ENV VITE_APP_STRIPE_PK=${VITE_APP_STRIPE_PK}
ENV VITE_APP_STRIPE_PRODUCT_ID=${VITE_APP_STRIPE_PRODUCT_ID}

RUN bun run build

EXPOSE 4173

CMD ["bun", "run", "preview"]